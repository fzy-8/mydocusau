---
title: 初识DOM
author: 墨鱼丸子
author_title: 三天摸鱼两天浑水
author_url: https://github.com/JoelMarcey
author_image_url: ../static/img/myFav/1.JPG
tags: [DOM, 初识]
description: 这是DOM有感第一篇。
image: https://i.imgur.com/mErPwqL.png
hide_table_of_contents: false
---

DOM🌲相关常识

<!--truncate-->



# DOM

> 参考：
> 
> 红宝书第14章、第15章、第16章和全能的MDN选手

## DOM中重要数据类型
- document 根文档
- element       元素或节点
- nodeList
- attribute
- namedNodeMap

## DOM中常用接口API

- document.getElementById(id)
- document.getElementsByTagName(name)
- document.createElement(name)
- parentNode.appendChild(node)
- element.innerHTML
- element.style.left
- element.setAttribute()
- element.getAttribute()
- element.addEventListener()
- window.content 🦊
- window.onload
- window.dump() 🦊
- window.scrollTo()

# DOM数据类型详解

## 1 Node类型

- node
  - nodeName
  - nodeValue
  - nodeType
  - childNodes

💡 `.nodeType`属性查询节点的类型（12种）。最常见：  
1 -- 元素节点  
3 -- 文本节点

### childNodes 属性
每个节点都有一个childNodes属性，其中包含一个NodeList的实例。NodeList是一个类数组对象，但并不是Array的实例。

💡 childNodes可以用`[]`访问或者`.item()`访问，也具有length属性。

#### Array.from() 方法 类数组转换成数组
```javascript
//使用Array.from(someNode.childNodes)可以将原型为NodeList转为Array。
> Array.from(document.body.childNodes)

< 
0: div#app
1: script
2: div#juejin-global-search
3: comment
4: text
5: comment
6: text
7: comment
8: text
9: comment
10: text
11: div.mask
12: text
length: 13
[[Prototype]]: Array(0)
//注意最后一行的原型已经变成了Array,之前运行someNode.childNodes原型还是NodeList.
```
#### hasChildNodes()方法
返回布尔值，查询是否含有此子节点。

### 节点关系属性
```javascript
someNode.firstChild             //第一个子节点
someNode.lastChild              //最后一个子节点
someNode.parentNode             //父节点
someNode.nextSibling            //下一个兄弟节点
someNode.previousSibling        //上一个兄弟节点
```

### 操纵节点 四兄弟 👨‍👩‍👧‍👧

💡 使用四公式之前，都需要先去的parentNode节点。

#### appendChild() 方法

在childNodes末尾添加节点；如果传入节点之前就存在，则改变其位置到最后。

#### insertBefore() 方法

在指定位置插入节点，而非最后。`insertBefore(要插入节点，参考节点)`当第二个参数不传入（null），则插入到最后。

#### replaceChild() 方法

以上两种方法都不删除节点，而第三种方法会删除原有节点。

#### removeChild() 方法

删除节点。

---

#### 附：方法

##### cloneNode()

复制节点。参数是一个布尔值，true表示“深复制”。

##### normalize() 方法

用于规范化文本节点。1.删除空白的文本节点；2.合并同一父节点下的多个并列的文本节点。

## 2 Document 类型

文档类型的节点是**只读**的（不可用以上提到的操纵节点方法：`appendChild()`、`removeChild()`、`replaceChild()`），而且只能有**一个Element**类型的子节点。

**页面文档的架构：**
- document
  - html
    - head
    - body
```
1. .documentElement: <HTML>元素节点的快捷方式
2. .body : <body>元素节点的快捷方式
```
### 🌶️ 获取文档节点方法 🌶️

以下方法的参数 大小写敏感，且只返回第一个符合的元素。

1. `getElementById(“元素的ID”)`
2. `getElementByTagName()` （个人常用这个）
3. `getElementByName()` -- 使用Name
4. `getElementByClassName()` -- 使用类名

还有一种方法是`querySelector()`和`querySelectorAll()`he
### 文档信息

```javascript
document.title
document.url
document.domain  //其中只有domain是可设置的，但也有诸多限制。
document.referrer
```

### 特殊集合
```javascript
document.anchors        //返回所有带name属性的<a>元素
document.forms
document.images
document.links          //返回所有带href属性的<a>元素
```

### 创建节点
```js
document.createElement("元素的标签名")
document.createTextNode("要插入的文本")   //创建文本节点
document.createComment("注释文本")
```

## 3 Element 类型

以下属性均可设置。

- element
  - nodeName / tagName 🌶️
  - id
  - title
  - lang
  - dir
  - className

### 获取属性 🌶️

#### 方法一：3种方法（更常用）

1. `getAttribute("属性名")`
2. `setAttribute("属性名","属性值")`
3. `removeAttribute("属性名")`

参数要求和示范：

```javascript
let div = document.getElementById("myDiv")

div.getAttribute("class");

div.replaceAttribute("class");

div.setAttribute("class","some");
```

#### 方法二：attributes属性

只有element类型拥有attributes属性，他返回一个NamedNodeMap实例，是一个类似NodeList的“实时”集合。

```js
getNamedItem("属性名")      //获取属性节点
removeNamedItem("属性名")   //删除
setNamedItem("属性名","属性值")   //设置属性节点

let id = element.attributes.getNamedItem("id").nodeValue
//等价于
let id = element.attributes["id"].nodeValue
//attributes[] 这种方法会更简便 🌶️
```

## 4 Text 类型

- text
  - nodeValue / data
    - length

修改文本内容的方法：
```javascript
appendData（text）                     //在末尾添加text
insertData(offset插入的起始位置，text)   //插入
replaceData(offset,count,text)        //替换
deletData(offset删除起始位置，count删除字符数)   //删除

document.createTextNode()   //创建文本节点
element.normalize();        //规范化文本节点
splitText(offset)           //拆分文本节点，与normalize()相反的方法
substringData(offset,count)  //提取文本信息
```

## 问题
🎫如何确定节点是元素节点？

```javascript
// 先检查节点类型！！！
if (someNode.nodeType == Node.ELEMENT_NODE){
    alert ("Node is an element.");
}
//元素节点的nodeType是1
```
# DOM动态编程

html和js都可以实现DOM编程。

## 动态脚本

方法有两种：

**1. 引入外部文件**

```js
//一个跨浏览器的函数
function loadScriptString(code){
  var script = document.createElement("script");
  script.type = "text/javascript";
  try {
    script.appendChild(document.createTextNode(code));  //方案一：先尝试append方法
  }catch (ex){
    script.text = code;                  //如果报错，就使用方案二：script的text属性
  }
  document.body.appendChild(script);    //最后一定要添加“script"元素到body末尾
  }
}

//调用函数
loadScriptString("function sayHi(){alert('hi');}");
```

**2. 直接插入源码**

```js
function loadStyleString(css){
  let style = document.createElement("style");
  style.type = "text/css";
  try{
    style.appendChild(document.createTextNode(css));
  }catch(ex){
    style.styleSheet.cssText = css;
  }
  let head = document.getElementsByTagName("head")[0];
  head.appendChild(style);
  }
}

//调用函数
loadStyleString("body{background-color:red}");
```
## 动态样式

```
两种方式：

1. <link>
2. <style>
```
```js
//方法一：<link>
//添加<link rel="stylesheet" type="text/css" href="styles.css">到<head>中
function loadStyles(url){
      let link = document.createElement("link");    //创建link节点
      link.rel = "stylesheet";
      link.type = "text/css";
      link.href = url;
      let head = document.getElementsByTagName("head")[0];    //添加link节点到<head>中
      head.appendChild(link);
}
//调用函数
loadStyles("styles.css");

//方法二：<style>
function loadStyleString(css){
  let style = document.createElement("style");    //创建<style>节点
  style.type = "text/css";
  try{
    style.appendChild(document.createTextNode(css));    //用DOM增加节点
  } catch (ex){
    style.styleSheet.cssText = css;   //访问属性style.styleSheet.cssText
  }
  let head = document.getElementsByTagName("head")[0];
    head.appendChild(style);    //添加style节点到<head>中
}
//调用函数
loadStyleString("body{background-color:red}");
```
